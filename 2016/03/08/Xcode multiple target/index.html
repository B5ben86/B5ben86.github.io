<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Xcode —— 使用Multi-Target管控相似App | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="[TOC] 前言在公司发展过程中，除了开发维护自有品牌外，针对有实力有潜质的客户，公司还会接受OEM「贴牌开发」的合作方式。在硬件产品方面，OEM方式主要体现于「外观重新开模改丝印」，「PCB重新layout」和「功能定制开发」；在App方面，主要体现于「App Logo修改」，「欢迎页面修改」，「关于我们页面修改」，「App背景颜色修改」和「功能定制开发」。目前公司的客户中，大概有5个客户是以O">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="Xcode —— 使用Multi-Target管控相似App">
<meta property="og:url" content="http://yoursite.com/2016/03/08/Xcode multiple target/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="[TOC] 前言在公司发展过程中，除了开发维护自有品牌外，针对有实力有潜质的客户，公司还会接受OEM「贴牌开发」的合作方式。在硬件产品方面，OEM方式主要体现于「外观重新开模改丝印」，「PCB重新layout」和「功能定制开发」；在App方面，主要体现于「App Logo修改」，「欢迎页面修改」，「关于我们页面修改」，「App背景颜色修改」和「功能定制开发」。目前公司的客户中，大概有5个客户是以O">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATarget%E6%96%B0%E5%BB%BATarget.jpg">
<meta property="og:image" content="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget-Info%20Group.jpg">
<meta property="og:image" content="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20Membership.jpg">
<meta property="og:image" content="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20welcomepage.jpg">
<meta property="og:updated_time" content="2018-04-17T03:34:52.097Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xcode —— 使用Multi-Target管控相似App">
<meta name="twitter:description" content="[TOC] 前言在公司发展过程中，除了开发维护自有品牌外，针对有实力有潜质的客户，公司还会接受OEM「贴牌开发」的合作方式。在硬件产品方面，OEM方式主要体现于「外观重新开模改丝印」，「PCB重新layout」和「功能定制开发」；在App方面，主要体现于「App Logo修改」，「欢迎页面修改」，「关于我们页面修改」，「App背景颜色修改」和「功能定制开发」。目前公司的客户中，大概有5个客户是以O">
<meta name="twitter:image" content="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATarget%E6%96%B0%E5%BB%BATarget.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Xcode multiple target" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/08/Xcode multiple target/" class="article-date">
  <time datetime="2016-03-08T08:36:59.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/iOS开发/">iOS开发</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Xcode —— 使用Multi-Target管控相似App
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在公司发展过程中，除了开发维护自有品牌外，针对有实力有潜质的客户，公司还会接受OEM「贴牌开发」的合作方式。在硬件产品方面，OEM方式主要体现于「外观重新开模改丝印」，「PCB重新layout」和「功能定制开发」；在App方面，主要体现于「App Logo修改」，「欢迎页面修改」，「关于我们页面修改」，「App背景颜色修改」和「功能定制开发」。<br>目前公司的客户中，大概有5个客户是以OEM的方式进行合作的，所以，对于App，需要采用一个容易维护的方式来管控公司及所有OEM客户的App。</p>
<a id="more"></a>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>针对「前言」中描述的情况，需要解决的问题可以归纳如下：</p>
<ul>
<li>6个App的代码需要共用，尽量减少代码间的差异</li>
<li>每个App的「应用名称」、「应用图标」、「欢迎页面」及「关于我们页面」均不同</li>
<li>在个别功能或页面在实现上，每个App均有一定差异性</li>
<li>每个App对应的开发者帐号均不同</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在Xcode中，有一个「Mutil-Target」功能，在<a href="https://developer.apple.com/library/ios/featuredarticles/XcodeConcepts/Concept-Targets.html" target="_blank" rel="noopener">苹果官方文档</a>中对于Target是这样描述的：</p>
<p>「A target specifies a product to build and contains the instructions for building the product form a set of files in a project or workspace. <code>A target defines a single product;</code> it organizes the inputs into the build system – the source files and instructions for processing those source files – required to build that product. Projects can contain one or more targets, each of which productes one product.」</p>
<p>这段话大概可以理解为「同一个Xcode工程中，<code>每一个target可以对应一个独立的App</code>，通过target相关的配置，可以定义每个Target（即App）的build属性：例如「需要编译哪些文件」、「App名称」、「App的Bundle ID」等」。这么看来，使用Target功能，即可满足此次需求。</p>
<p>添加Target的过程可分为以下几步：</p>
<h4 id="新建Target"><a href="#新建Target" class="headerlink" title="新建Target"></a>新建Target</h4><p>根据需求，新Target的大部分内容跟原Target相似，所以我们使用「Duplicate」的方式来「复制生成」新Target。点击Target名称可以很方便地改名，假设名称改为「NewTarget」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATarget%E6%96%B0%E5%BB%BATarget.jpg" alt=""></p>
<h4 id="设置「App名称」"><a href="#设置「App名称」" class="headerlink" title="设置「App名称」"></a>设置「App名称」</h4><h5 id="设置info-plist文件"><a href="#设置info-plist文件" class="headerlink" title="设置info.plist文件"></a>设置info.plist文件</h5><p>1) 添加「NewTarget」后，可以发现工程中多了一个「Target_copy-info.plist」，在此，我们将其名称改为「NewTarget-info.plist」，一般来说，此文件内容不需要修改。</p>
<p>2) 在「TARGETS」中选择「NewTarget」，进入工程的「Build Setting」页面，找到「Packaging」分类，把里面的「info.plist File」改为「NewTarget-info.plist」</p>
<p>3) 此时回到「General」页面，就可以对Bundle Identifier」和「Team」等选项进行修改了。</p>
<h5 id="设置infoPlist-strings文件"><a href="#设置infoPlist-strings文件" class="headerlink" title="设置infoPlist.strings文件"></a>设置infoPlist.strings文件</h5><p>1) 在工程目录中新建文件夹「NewTargetInfo」。</p>
<p>2) 找到工程文件夹中的infoPlist.strings文件（注意，每种语言均有一个infoPlist.strings文件），将其复制到文件夹「NewTargetInfo」中。</p>
<p>3) 在Xcode工程中新建Group「NewTarget-Info」，将「NewTarget-info.plist」拖到该Group中，同时，通过「Add Files to “Target”」选项将步骤2)中的infoPlist.strings文件添加到Group「NewTarget-Info」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget-Info%20Group.jpg" alt=""></p>
<p>4) 选中「infoPlist.strings」，在「Utilities View」中的「Target Membership」选项，选择此「infoPlist.strings」属于哪个Target，注意，这里不能多选，只能选中「NewTarget」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20Membership.jpg" alt=""></p>
<p>5) 打开「infoPlist.strings」文件，在各个语言文件中添加下述语句，其中「AppName」根据需求填写。</p>
<pre><code>&quot;CFBundleDisplayName&quot; = &quot;AppName&quot;;
</code></pre><h4 id="添加「App图标」及「启动页面」"><a href="#添加「App图标」及「启动页面」" class="headerlink" title="添加「App图标」及「启动页面」"></a>添加「App图标」及「启动页面」</h4><h5 id="添加「App图标」"><a href="#添加「App图标」" class="headerlink" title="添加「App图标」"></a>添加「App图标」</h5><p>添加「App图标」相对简单</p>
<p>1) 进入「Images.xcassets」中，通过「按住Option按钮拖拽」的方式，得到原来的「AppIcon」的拷贝，将其改名为「NewTarget AppIcon」；</p>
<p>2) 右键「Show in Finder」，将新的App图标按照相同的名称拷贝进文件夹，覆盖原有图标。</p>
<p>3) 进入「NewTarget」的「General」页面，找到「App Icons and Launch Images」分类，在「App Icons Source」选项中选择「NewTarget AppIcon」；</p>
<h5 id="添加「启动页面」"><a href="#添加「启动页面」" class="headerlink" title="添加「启动页面」"></a>添加「启动页面」</h5><p>「启动页面」分两种情况，一种是IOS7及以下版本的「启动页面」，一种是IOS8及以上版本的「启动页面」</p>
<h6 id="对于IOS7及以下版本"><a href="#对于IOS7及以下版本" class="headerlink" title="对于IOS7及以下版本"></a>对于IOS7及以下版本</h6><p>参考「App图标」的三步配置，即可为「NewTarget」创建新的「启动页面」</p>
<h6 id="对于IOS8及以上版本"><a href="#对于IOS8及以上版本" class="headerlink" title="对于IOS8及以上版本"></a>对于IOS8及以上版本</h6><p>由于IOS8及以上版本的启动页面使用的是「Launch Screen」，而「Launch Screen」的样式只能通过修改.xib页面实现，不可编写任何代码。假设「Launch Screen」中只有一个ImageView元件，ImageView元件的image为「welcomePage.png」，那么，我们可以在工程中添加多个同名但不同内容的welcomePage.png，并通过「Target Membership」来定义不同的「welcomePage.png」分别关联哪个Target，即可实现不同Target使用不同「启动页面」的目的。</p>
<p><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20welcomepage.jpg" alt=""></p>
<h4 id="添加预编译宏"><a href="#添加预编译宏" class="headerlink" title="添加预编译宏"></a>添加预编译宏</h4><p>对于不同Target间代码级别的差异，我们可以通过预编译宏来实现代码预编译。进入「Target」的「Build Settings」界面，找到「Preprocessor Macros」选项，在「Debug」及「Release」选项中，按需增加宏定义。例如，为「NewTarget」添加宏定义<br>​<br>    “TARGET_TYPE”=”NEW_TARGET”<br>那么在代码中，即可通过预编译语句实现代码的差别编译。</p>
<pre><code>#if TARGET_TYPE == NEW_TARGET
    //do something for NewTarget
#else
    //do something for OtherTarget
#end
</code></pre><h4 id="Manage-Schemes"><a href="#Manage-Schemes" class="headerlink" title="Manage Schemes"></a>Manage Schemes</h4><p>最后一步！将系统默认生成的 build Scheme 名称改为「New Target Release」即可，当然，还可以按需添加不同的 scheme.</p>
<h3 id="坑！！！"><a href="#坑！！！" class="headerlink" title="坑！！！"></a>坑！！！</h3><h4 id="奇怪的编译问题"><a href="#奇怪的编译问题" class="headerlink" title="奇怪的编译问题"></a>奇怪的编译问题</h4><pre><code>_Warning: The Copy Bundle Resources build phase contains this target&apos;s Info.plist file &apos;Simart-Info.plist&apos;._
</code></pre><p>原因：在「Target-Info.plist」的「Target Membership」选项中误选了某个Target，正常情况下，「Target-Info.plist」在「Target Membership」选项中是<strong>不选择</strong>任何一个Target的。</p>
<pre><code>Unable to run command &apos;CpResource Simart.app&apos; - this target might include its own product.
Unable to run command &apos;Touch Simart.app&apos; - this target might include its own product.
</code></pre><p>原因：在「Products」Group中的某个product的「Target Membership」中给误选了某个Target，正常情况下product不应该关联到任何一个Target。</p>
<h4 id="App名称无法修改"><a href="#App名称无法修改" class="headerlink" title="App名称无法修改"></a>App名称无法修改</h4><p>原因：在修改「NewTarget」的「InfoPlist.strings」文件时，发现无论如何修改，App名称都会显示OriginalTarget的App名称，排查后发现，「OriginalTarget」的「InfoPlist.strings」的「Target Membership」中除了勾选了「OriginalTarget」外，还勾选了「NewTarget」，这就导致了在编译「NewTarget」时，错误地读取了「OriginalTarget」的「InfoPlist.strings」文件。</p>
<p>重新检查一遍所有Target「InfoPlist.strings」的「Target Membership」选项，保证关联的唯一性和正确性即可。</p>
<h4 id="「启动页面」无法显示"><a href="#「启动页面」无法显示" class="headerlink" title="「启动页面」无法显示"></a>「启动页面」无法显示</h4><p>此问题出现在IOS8.0及以上版本中。</p>
<p>问题具体表现为：无论使用模拟器或者真机调试，在切换Target时，均会「随机」出现「启动页面」变成白色。检查了很多遍各个Target的配置，并未发现问题。</p>
<p>最后，Achive每个Target的AD HOC版本，并通过fir.im进行分发测试，发现每个Target的「启动页面」均正常，难道这是Xcode-7.2.1的Bug？目前不得而知，待后续跟进…</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来说，使用「Multi-Target」方案，算是「完美地」解决了此次需求。同时，此方案也可用于「发布独立的测试版本」「发布有限制的App版本」等需求。</p>
<p>总而言之，只要理解了<code>A target defines a single product</code>，具体怎么用就看项目的实际需求了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/08/Xcode multiple target/" data-id="cjg348srk0003zhtpi9zgizkn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/23/Introductin-Protocol-Oriented-Programming-in-Swift-2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Swift 2之协议式编程介绍「译」
        
      </div>
    </a>
  
  
    <a href="/2016/02/29/Blog_build_up/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Blog搭建指南 —— 基于Github 和 Hexo</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS开发/">iOS开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术文档翻译/">技术文档翻译</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/17/vue+koa2+mySQL+Ngnix框架搭建备忘/">vue+koa2+mySQL+Ngnix框架搭建备忘</a>
          </li>
        
          <li>
            <a href="/2016/11/06/iOS — 使用 Container View 实现左右侧栏/">iOS —— 使用 Container View 实现左右侧栏</a>
          </li>
        
          <li>
            <a href="/2016/11/06/iOS — Slider with Container View/">iOS —— 使用 Container View 实现左右侧栏</a>
          </li>
        
          <li>
            <a href="/2016/04/17/iOS-Architecture-Patterns/">iOS 软件架构 - MVC, MVP, MVVM 和 VIPER 「译」</a>
          </li>
        
          <li>
            <a href="/2016/03/23/Introductin-Protocol-Oriented-Programming-in-Swift-2/">Swift 2之协议式编程介绍「译」</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>