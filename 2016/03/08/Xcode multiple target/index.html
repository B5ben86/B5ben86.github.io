<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Xcode —— 使用Multi-Target管控相似App | Chamchamben的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Xcode —— 使用Multi-Target管控相似App</h1><a id="logo" href="/.">Chamchamben的博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Xcode —— 使用Multi-Target管控相似App</h1><div class="post-meta">Mar 8, 2016<span> | </span><span class="category"><a href="/categories/iOS开发/">iOS开发</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/2016/03/08/Xcode multiple target/#vcomment"><span class="valine-comment-count" data-xid="/2016/03/08/Xcode multiple target/"></span><span> 条评论</span></a><div class="post-content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在公司发展过程中，除了开发维护自有品牌外，针对有实力有潜质的客户，公司还会接受OEM「贴牌开发」的合作方式。在硬件产品方面，OEM方式主要体现于「外观重新开模改丝印」，「PCB重新layout」和「功能定制开发」；在App方面，主要体现于「App Logo修改」，「欢迎页面修改」，「关于我们页面修改」，「App背景颜色修改」和「功能定制开发」。<br>目前公司的客户中，大概有5个客户是以OEM的方式进行合作的，所以，对于App，需要采用一个容易维护的方式来管控公司及所有OEM客户的App。</p>
<a id="more"></a>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>针对「前言」中描述的情况，需要解决的问题可以归纳如下：</p>
<ul>
<li>6个App的代码需要共用，尽量减少代码间的差异</li>
<li>每个App的「应用名称」、「应用图标」、「欢迎页面」及「关于我们页面」均不同</li>
<li>在个别功能或页面在实现上，每个App均有一定差异性</li>
<li>每个App对应的开发者帐号均不同</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>在Xcode中，有一个「Mutil-Target」功能，在<a href="https://developer.apple.com/library/ios/featuredarticles/XcodeConcepts/Concept-Targets.html" target="_blank" rel="noopener">苹果官方文档</a>中对于Target是这样描述的：</p>
<p>「A target specifies a product to build and contains the instructions for building the product form a set of files in a project or workspace. <code>A target defines a single product;</code> it organizes the inputs into the build system – the source files and instructions for processing those source files – required to build that product. Projects can contain one or more targets, each of which productes one product.」</p>
<p>这段话大概可以理解为「同一个Xcode工程中，<code>每一个target可以对应一个独立的App</code>，通过target相关的配置，可以定义每个Target（即App）的build属性：例如「需要编译哪些文件」、「App名称」、「App的Bundle ID」等」。这么看来，使用Target功能，即可满足此次需求。</p>
<p>添加Target的过程可分为以下几步：</p>
<h4 id="新建Target"><a href="#新建Target" class="headerlink" title="新建Target"></a>新建Target</h4><p>根据需求，新Target的大部分内容跟原Target相似，所以我们使用「Duplicate」的方式来「复制生成」新Target。点击Target名称可以很方便地改名，假设名称改为「NewTarget」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATarget%E6%96%B0%E5%BB%BATarget.jpg" alt=""></p>
<h4 id="设置「App名称」"><a href="#设置「App名称」" class="headerlink" title="设置「App名称」"></a>设置「App名称」</h4><h5 id="设置info-plist文件"><a href="#设置info-plist文件" class="headerlink" title="设置info.plist文件"></a>设置info.plist文件</h5><p>1) 添加「NewTarget」后，可以发现工程中多了一个「Target_copy-info.plist」，在此，我们将其名称改为「NewTarget-info.plist」，一般来说，此文件内容不需要修改。</p>
<p>2) 在「TARGETS」中选择「NewTarget」，进入工程的「Build Setting」页面，找到「Packaging」分类，把里面的「info.plist File」改为「NewTarget-info.plist」</p>
<p>3) 此时回到「General」页面，就可以对Bundle Identifier」和「Team」等选项进行修改了。</p>
<h5 id="设置infoPlist-strings文件"><a href="#设置infoPlist-strings文件" class="headerlink" title="设置infoPlist.strings文件"></a>设置infoPlist.strings文件</h5><p>1) 在工程目录中新建文件夹「NewTargetInfo」。</p>
<p>2) 找到工程文件夹中的infoPlist.strings文件（注意，每种语言均有一个infoPlist.strings文件），将其复制到文件夹「NewTargetInfo」中。</p>
<p>3) 在Xcode工程中新建Group「NewTarget-Info」，将「NewTarget-info.plist」拖到该Group中，同时，通过「Add Files to “Target”」选项将步骤2)中的infoPlist.strings文件添加到Group「NewTarget-Info」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget-Info%20Group.jpg" alt=""></p>
<p>4) 选中「infoPlist.strings」，在「Utilities View」中的「Target Membership」选项，选择此「infoPlist.strings」属于哪个Target，注意，这里不能多选，只能选中「NewTarget」。<br><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20Membership.jpg" alt=""></p>
<p>5) 打开「infoPlist.strings」文件，在各个语言文件中添加下述语句，其中「AppName」根据需求填写。</p>
<pre><code>&quot;CFBundleDisplayName&quot; = &quot;AppName&quot;;
</code></pre><h4 id="添加「App图标」及「启动页面」"><a href="#添加「App图标」及「启动页面」" class="headerlink" title="添加「App图标」及「启动页面」"></a>添加「App图标」及「启动页面」</h4><h5 id="添加「App图标」"><a href="#添加「App图标」" class="headerlink" title="添加「App图标」"></a>添加「App图标」</h5><p>添加「App图标」相对简单</p>
<p>1) 进入「Images.xcassets」中，通过「按住Option按钮拖拽」的方式，得到原来的「AppIcon」的拷贝，将其改名为「NewTarget AppIcon」；</p>
<p>2) 右键「Show in Finder」，将新的App图标按照相同的名称拷贝进文件夹，覆盖原有图标。</p>
<p>3) 进入「NewTarget」的「General」页面，找到「App Icons and Launch Images」分类，在「App Icons Source」选项中选择「NewTarget AppIcon」；</p>
<h5 id="添加「启动页面」"><a href="#添加「启动页面」" class="headerlink" title="添加「启动页面」"></a>添加「启动页面」</h5><p>「启动页面」分两种情况，一种是IOS7及以下版本的「启动页面」，一种是IOS8及以上版本的「启动页面」</p>
<h6 id="对于IOS7及以下版本"><a href="#对于IOS7及以下版本" class="headerlink" title="对于IOS7及以下版本"></a>对于IOS7及以下版本</h6><p>参考「App图标」的三步配置，即可为「NewTarget」创建新的「启动页面」</p>
<h6 id="对于IOS8及以上版本"><a href="#对于IOS8及以上版本" class="headerlink" title="对于IOS8及以上版本"></a>对于IOS8及以上版本</h6><p>由于IOS8及以上版本的启动页面使用的是「Launch Screen」，而「Launch Screen」的样式只能通过修改.xib页面实现，不可编写任何代码。假设「Launch Screen」中只有一个ImageView元件，ImageView元件的image为「welcomePage.png」，那么，我们可以在工程中添加多个同名但不同内容的welcomePage.png，并通过「Target Membership」来定义不同的「welcomePage.png」分别关联哪个Target，即可实现不同Target使用不同「启动页面」的目的。</p>
<p><img src="http://7xra14.com1.z0.glb.clouddn.com/%E5%A4%9ATargetTarget%20welcomepage.jpg" alt=""></p>
<h4 id="添加预编译宏"><a href="#添加预编译宏" class="headerlink" title="添加预编译宏"></a>添加预编译宏</h4><p>对于不同Target间代码级别的差异，我们可以通过预编译宏来实现代码预编译。进入「Target」的「Build Settings」界面，找到「Preprocessor Macros」选项，在「Debug」及「Release」选项中，按需增加宏定义。例如，为「NewTarget」添加宏定义<br>​<br>    “TARGET_TYPE”=”NEW_TARGET”<br>那么在代码中，即可通过预编译语句实现代码的差别编译。</p>
<pre><code>#if TARGET_TYPE == NEW_TARGET
    //do something for NewTarget
#else
    //do something for OtherTarget
#end
</code></pre><h4 id="Manage-Schemes"><a href="#Manage-Schemes" class="headerlink" title="Manage Schemes"></a>Manage Schemes</h4><p>最后一步！将系统默认生成的 build Scheme 名称改为「New Target Release」即可，当然，还可以按需添加不同的 scheme.</p>
<h3 id="坑！！！"><a href="#坑！！！" class="headerlink" title="坑！！！"></a>坑！！！</h3><h4 id="奇怪的编译问题"><a href="#奇怪的编译问题" class="headerlink" title="奇怪的编译问题"></a>奇怪的编译问题</h4><pre><code>_Warning: The Copy Bundle Resources build phase contains this target&apos;s Info.plist file &apos;Simart-Info.plist&apos;._
</code></pre><p>原因：在「Target-Info.plist」的「Target Membership」选项中误选了某个Target，正常情况下，「Target-Info.plist」在「Target Membership」选项中是<strong>不选择</strong>任何一个Target的。</p>
<pre><code>Unable to run command &apos;CpResource Simart.app&apos; - this target might include its own product.
Unable to run command &apos;Touch Simart.app&apos; - this target might include its own product.
</code></pre><p>原因：在「Products」Group中的某个product的「Target Membership」中给误选了某个Target，正常情况下product不应该关联到任何一个Target。</p>
<h4 id="App名称无法修改"><a href="#App名称无法修改" class="headerlink" title="App名称无法修改"></a>App名称无法修改</h4><p>原因：在修改「NewTarget」的「InfoPlist.strings」文件时，发现无论如何修改，App名称都会显示OriginalTarget的App名称，排查后发现，「OriginalTarget」的「InfoPlist.strings」的「Target Membership」中除了勾选了「OriginalTarget」外，还勾选了「NewTarget」，这就导致了在编译「NewTarget」时，错误地读取了「OriginalTarget」的「InfoPlist.strings」文件。</p>
<p>重新检查一遍所有Target「InfoPlist.strings」的「Target Membership」选项，保证关联的唯一性和正确性即可。</p>
<h4 id="「启动页面」无法显示"><a href="#「启动页面」无法显示" class="headerlink" title="「启动页面」无法显示"></a>「启动页面」无法显示</h4><p>此问题出现在IOS8.0及以上版本中。</p>
<p>问题具体表现为：无论使用模拟器或者真机调试，在切换Target时，均会「随机」出现「启动页面」变成白色。检查了很多遍各个Target的配置，并未发现问题。</p>
<p>最后，Achive每个Target的AD HOC版本，并通过fir.im进行分发测试，发现每个Target的「启动页面」均正常，难道这是Xcode-7.2.1的Bug？目前不得而知，待后续跟进…</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总的来说，使用「Multi-Target」方案，算是「完美地」解决了此次需求。同时，此方案也可用于「发布独立的测试版本」「发布有限制的App版本」等需求。</p>
<p>总而言之，只要理解了<code>A target defines a single product</code>，具体怎么用就看项目的实际需求了。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a class="article-share-link" data-url="https://b5ben86.coding.me/2016/03/08/Xcode multiple target/" data-id="cjg3g04930002nwlunt8973vi" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMUlEQVR42u3aQZKDMAwEwPz/0+w1F8iMDVuF3ZxSpAJuHxTJ0ucTX8fXdXb/+9uz+/m7Pk9cGBgYr2Ucl9cZ45qUPP9s6dfbcbo1GBgYGzCuA1/+mgSWh/VkbRgYGBjXS08SxOsAjYGBgfEEoy0+r++3CSgGBsbOjKSIbUl5UG6/xcDA2I3RHtb/5+dH+hsYGBivYhzllZegd4XUaFUYGBhLM+ZTveQwbqadWQx/YGBgbMDIQ9v8QsfGNaaO2zAwMF7LGDvMem54oj3yizJcDAyMJRh1ElYenLVFbL1lGBgYSzOSByWkJIFrhyry0IyBgbEDox3VurfZedegGAYGxtqM9mhsbDxrZtQs+hUGBsY2jPawLOElT8jL6aiFiYGBsRCjzhwnljU/dhZNi2BgYCzHaMvINoGb+dVgewADA2M5Rhtw20GxmcGvB1NDDAyMVzHGytG8zTnTqmz/GDAwMFZljL0yL0eTEbH8Xaf3MTAwlmbUbcI4vM4MmbXNBgwMjB0YY4VlO+aVBNyptBIDA2NjRlvc5klemzLWbUsMDIzlGPmgQ9ukTI7121GPH+UrBgbGQoyjvPKiN0G24ftH/Y2BgbEo44bOZxx824GMfLMwMDB2YIwddY0d7rdbVuw3BgbGBoy2qdlG9HuLWAwMDIzkUH5m5Gss4P4IwRgYGBjlcNjYyEVeQp8WsRgYGEsz2rGtNinMqYMJKAYGxtKMtnTMk7Z2RCx5/lRTEwMD432MPySjIuBat3dgAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a class="pre" href="/2016/03/23/Introductin-Protocol-Oriented-Programming-in-Swift-2/">Swift 2之协议式编程介绍「译」</a><a class="next" href="/2016/02/29/Blog_build_up/">Blog搭建指南 —— 基于Github 和 Hexo</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'true' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'tf1GdjfRJbKRSyBuBbqPB6k6-gzGzoHsz',
  appKey:'TmWT8tiQdTXXqeMIt3EqoSJK',
  placeholder:'What do you want?',
  avatar:'wavatar',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://b5ben86.coding.me"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS开发/">iOS开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术文档翻译/">技术文档翻译</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Node-js/" style="font-size: 15px;">Node.js</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/vue+koa2+mySQL+Ngnix框架搭建备忘/">vue+koa2+mySQL+Ngnix框架搭建备忘</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/06/iOS — Slider with Container View/">iOS —— 使用 Container View 实现左右侧栏2</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/17/iOS-Architecture-Patterns/">iOS 软件架构 - MVC, MVP, MVVM 和 VIPER 「译」</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/23/Introductin-Protocol-Oriented-Programming-in-Swift-2/">Swift 2之协议式编程介绍「译」</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/Xcode multiple target/">Xcode —— 使用Multi-Target管控相似App</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/29/Blog_build_up/">Blog搭建指南 —— 基于Github 和 Hexo</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://b5ben86.github.io/" title="GitHub Blog" target="_blank">GitHub Blog</a><ul></ul><a href="http://b5ben86.gitee.io/" title="Gitee Blog" target="_blank">Gitee Blog</a><ul></ul><a href="https://b5ben86.coding.me/" title="Coding Blog" target="_blank">Coding Blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Chamchamben的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>