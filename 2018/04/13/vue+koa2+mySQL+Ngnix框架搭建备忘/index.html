<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="目录   目录 1. 整体框架 1.1 使用的框架： 1.2 CentOS 下安装 NodeJS   2. vue 2.1 安装 2.1 使用 vue-cli 手脚架搭建工程目录 2.2 使用 vuex 实现 component 之间的通讯 2.3 使用 axios 实现 Http/Https client 功能 2.4 使用 vue-router 实现单页面 Web 应用的路由功能 2.5 vu">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2018/04/13/vue+koa2+mySQL+Ngnix框架搭建备忘/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="目录   目录 1. 整体框架 1.1 使用的框架： 1.2 CentOS 下安装 NodeJS   2. vue 2.1 安装 2.1 使用 vue-cli 手脚架搭建工程目录 2.2 使用 vuex 实现 component 之间的通讯 2.3 使用 axios 实现 Http/Https client 功能 2.4 使用 vue-router 实现单页面 Web 应用的路由功能 2.5 vu">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-04-16T07:58:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="目录   目录 1. 整体框架 1.1 使用的框架： 1.2 CentOS 下安装 NodeJS   2. vue 2.1 安装 2.1 使用 vue-cli 手脚架搭建工程目录 2.2 使用 vuex 实现 component 之间的通讯 2.3 使用 axios 实现 Http/Https client 功能 2.4 使用 vue-router 实现单页面 Web 应用的路由功能 2.5 vu">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-vue+koa2+mySQL+Ngnix框架搭建备忘" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/13/vue+koa2+mySQL+Ngnix框架搭建备忘/" class="article-date">
  <time datetime="2018-04-13T08:35:39.607Z" itemprop="datePublished">2018-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
<!-- code_chunk_output -->
<ul>
<li><a href="#目录">目录</a></li>
<li><a href="#1-整体框架">1. 整体框架</a><ul>
<li><a href="#11-使用的框架">1.1 使用的框架：</a></li>
<li><a href="#12-centos-下安装-nodejs">1.2 CentOS 下安装 NodeJS</a></li>
</ul>
</li>
<li><a href="#2-vue">2. vue</a><ul>
<li><a href="#21-安装">2.1 安装</a></li>
<li><a href="#21-使用-vue-cli-手脚架搭建工程目录">2.1 使用 vue-cli 手脚架搭建工程目录</a></li>
<li><a href="#22-使用-vuex-实现-component-之间的通讯">2.2 使用 vuex 实现 component 之间的通讯</a></li>
<li><a href="#23-使用-axios-实现-httphttps-client-功能">2.3 使用 axios 实现 Http/Https client 功能</a></li>
<li><a href="#24-使用-vue-router-实现单页面-web-应用的路由功能">2.4 使用 vue-router 实现单页面 Web 应用的路由功能</a></li>
<li><a href="#25-vue-ui-组件">2.5 vue UI 组件</a></li>
</ul>
</li>
<li><a href="#3-基于-koa-框架的后端实现">3. 基于 koa 框架的后端实现</a><ul>
<li><a href="#31-使用-koa2-generator-生成工程目录">3.1 使用 koa2-generator 生成工程目录</a></li>
<li><a href="#32-处理工程依赖-packagejson">3.2 处理工程依赖 package.json</a></li>
<li><a href="#33-https-实现方式">3.3 Https 实现方式</a></li>
<li><a href="#34-mysql-操作">3.4 MySQL 操作</a></li>
</ul>
</li>
<li><a href="#4-nginx-配置">4. Nginx 配置</a><ul>
<li><a href="#41-安装">4.1 安装</a></li>
<li><a href="#42-配置">4.2 配置</a></li>
</ul>
</li>
</ul>
<!-- /code_chunk_output -->
<h1 id="1-整体框架"><a href="#1-整体框架" class="headerlink" title="1. 整体框架"></a>1. 整体框架</h1><p>采用前后端解耦的开发方式，实现 Web 单页应用.</p>
<h2 id="1-1-使用的框架："><a href="#1-1-使用的框架：" class="headerlink" title="1.1 使用的框架："></a>1.1 使用的框架：</h2><ul>
<li>VUE: 前端框架</li>
<li>axios: http/https client</li>
<li>ws: <a href="https://github.com/websockets/ws" target="_blank" rel="noopener">websocket框架</a> <a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001472794708264206fcf1589bb43caa0395752aa26538c000" target="_blank" rel="noopener">例子</a></li>
<li>net: <a href="https://nodejs.org/api/net.html" target="_blank" rel="noopener">TCP 框架</a></li>
<li>node.js 多线程/多进程？</li>
<li>koa2: 后端 web 框架</li>
<li>Sequelize: MySQL ORM</li>
<li>Nginx: 网页服务器代理</li>
<li>PM2: <a href="http://pm2.keymetrics.io/" target="_blank" rel="noopener">带有负载均衡功能的Node应用的进程管理器</a></li>
</ul>
<h2 id="1-2-CentOS-下安装-NodeJS"><a href="#1-2-CentOS-下安装-NodeJS" class="headerlink" title="1.2 CentOS 下安装 NodeJS"></a>1.2 CentOS 下安装 NodeJS</h2><p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js官网</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载 Node.js 二进制文件</span></span><br><span class="line"><span class="comment"># 登录网址获取下载链接: https://nodejs.org/en/download/</span></span><br><span class="line">$ wgets https://nodejs.org/dist/v9.11.1/node-v9.11.1-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载解压软件</span></span><br><span class="line">$ yum install xz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">$ xz -d node-v9.11.1-linux-x64.tar.xz</span><br><span class="line">$ tar -xf node-v9.11.1-linux-x64.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名称</span></span><br><span class="line">$ mv node-v9.11.1-linux-x64 node-v9.11.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建命令快捷方式</span></span><br><span class="line">$ <span class="built_in">cd</span> node-v9.11.1/bin</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">$ ln -s ....../node /usr/<span class="built_in">local</span>/bin/node</span><br><span class="line">$ ln -s ....../npm /usr/<span class="built_in">local</span>/bin/npm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">$ node -v</span><br></pre></td></tr></table></figure>
<h1 id="2-vue"><a href="#2-vue" class="headerlink" title="2. vue"></a>2. vue</h1><p><a href="https://cn.vuejs.org/" target="_blank" rel="noopener">官方网站</a></p>
<h2 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g vue</span><br></pre></td></tr></table></figure>
<h2 id="2-1-使用-vue-cli-手脚架搭建工程目录"><a href="#2-1-使用-vue-cli-手脚架搭建工程目录" class="headerlink" title="2.1 使用 vue-cli 手脚架搭建工程目录"></a>2.1 使用 vue-cli 手脚架搭建工程目录</h2><p>通过 vue-cli 手脚架，可以方便地生成 webpack 风格的工程目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g vue-cli</span><br><span class="line">$ vue init webpack my-project</span><br><span class="line">$ <span class="built_in">cd</span> my-project</span><br><span class="line"><span class="comment">#安装所需库</span></span><br><span class="line">$ npm install</span><br><span class="line"><span class="comment">#运行</span></span><br><span class="line">$ npm run dev</span><br><span class="line"><span class="comment">#网站部署</span></span><br><span class="line">$ npm run build</span><br><span class="line"><span class="comment">#编译成功后，只需要将 dist 目录下的所有内容上传到服务器中，即可完成部署</span></span><br><span class="line">$ <span class="built_in">cd</span> dist</span><br></pre></td></tr></table></figure>
<h2 id="2-2-使用-vuex-实现-component-之间的通讯"><a href="#2-2-使用-vuex-实现-component-之间的通讯" class="headerlink" title="2.2 使用 vuex 实现 component 之间的通讯"></a>2.2 使用 vuex 实现 component 之间的通讯</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in moduleA.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义当前 vuex module 中的变量</span></span><br><span class="line"><span class="comment">//一个 vuex 可以包含多个 module</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">	itemList:[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义 module 中变量的 getters</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">	getItemList(state) &#123;</span><br><span class="line">		<span class="keyword">return</span> state.itemList</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义 module 中的 mutations, 所有针对变量的修改都要放到 mutations 中</span></span><br><span class="line"><span class="comment">//所有 mutation 都应该是同步函数，调用的函数也应该是同步函数</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">	<span class="comment">//更新 itemList</span></span><br><span class="line">	updateItemList(state, itemListNew) &#123;</span><br><span class="line">		state.itemList = itemListNew || []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义 module 中的 actions，action 可以调用 mutations，也可以执行异步操作</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">	<span class="keyword">async</span> updateItemListFromServer(&#123;commit&#125;) &#123;</span><br><span class="line">		<span class="comment">//从服务器获取最新数据（异步方式）</span></span><br><span class="line">		<span class="keyword">var</span> itemListNew = <span class="keyword">await</span> api.getItemListFromServer()</span><br><span class="line">		<span class="comment">//数据获取成功后，通过 mutation 更新 state.itemList</span></span><br><span class="line">		commit(<span class="string">'updateItemList'</span>, itemListNew)</span><br><span class="line">	&#125;,</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">async</span> insertNewItemToServer(&#123;commit&#125;, itemNew) &#123;</span><br><span class="line">		<span class="comment">//向服务器插入一个 itemNew, 服务器返回最新的 itemList</span></span><br><span class="line">		<span class="keyword">var</span> itemListNew = <span class="keyword">await</span> api.insertNewItemToServer(itemNew)</span><br><span class="line">		<span class="comment">//数据获取成功后，通过 mutation 更新 state.itemList</span></span><br><span class="line">		commit(<span class="string">'updateItemList'</span>, itemListNew)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	state,</span><br><span class="line">	getters,</span><br><span class="line">	mutations,</span><br><span class="line">	actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in store.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> moduleA <span class="keyword">from</span> <span class="string">'./modules/moduleA'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">	modules: &#123;</span><br><span class="line">		moduleA,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//in main.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./APP'</span></span><br><span class="line"><span class="keyword">import</span> Store <span class="keyword">from</span> <span class="string">'./store/store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  Store,</span><br><span class="line">  components: &#123;</span><br><span class="line">    App</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>定义完 vuex 的 module 后，component 之间就可以通过 store 实例对 module 中的数据进行修改和访问，从而实现 component 之间的数据通讯.</p>
<h2 id="2-3-使用-axios-实现-Http-Https-client-功能"><a href="#2-3-使用-axios-实现-Http-Https-client-功能" class="headerlink" title="2.3 使用 axios 实现 Http/Https client 功能"></a>2.3 使用 axios 实现 Http/Https client 功能</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只支持 IE10 及后续版本，其他主流浏览器均支持</span></span><br><span class="line">$ npm install -g axios</span><br></pre></td></tr></table></figure>
<p>使用范例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> domain = <span class="string">'http://localhost:3000'</span>;</span><br><span class="line"><span class="keyword">const</span> getItemAPI = domain + <span class="string">'/all'</span>;</span><br><span class="line"><span class="keyword">const</span> addItemAPI = domain + <span class="string">'/add'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	<span class="keyword">async</span> getItemListFromServer() &#123;</span><br><span class="line">		<span class="keyword">var</span> response = <span class="keyword">await</span> Axios.get(getItemAPI)</span><br><span class="line">		<span class="keyword">return</span> response.data.itemList || []</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="keyword">async</span> addNewItemToServer(itemNew) &#123;</span><br><span class="line">		<span class="keyword">var</span> body = &#123;</span><br><span class="line">			itemNew: itemNew,</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">var</span> response = <span class="keyword">await</span> Axios.post(addItemAPI, body)</span><br><span class="line">		<span class="keyword">return</span> response.data.itemList || []</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：若使用 HTTPS 访问 VUE 网页应用，则 axios 也需要访问支持 HTTPS 的后端 API，否则不能通信</strong></p>
<h2 id="2-4-使用-vue-router-实现单页面-Web-应用的路由功能"><a href="#2-4-使用-vue-router-实现单页面-Web-应用的路由功能" class="headerlink" title="2.4 使用 vue-router 实现单页面 Web 应用的路由功能"></a>2.4 使用 vue-router 实现单页面 Web 应用的路由功能</h2><p><a href="https://router.vuejs.org/zh-cn/installation.html" target="_blank" rel="noopener">官方网站</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install vue-router</span><br></pre></td></tr></table></figure>
<p>功能待详细测试…</p>
<h2 id="2-5-vue-UI-组件"><a href="#2-5-vue-UI-组件" class="headerlink" title="2.5 vue UI 组件"></a>2.5 vue UI 组件</h2><p><a href="http://element-cn.eleme.io/#/zh-CN" target="_blank" rel="noopener">Element官方网站</a></p>
<p>Element 是饿了么官方发布维护的基于 Vue2.0 的桌面端组件库</p>
<p>功能待详细测试…</p>
<h1 id="3-基于-koa-框架的后端实现"><a href="#3-基于-koa-框架的后端实现" class="headerlink" title="3. 基于 koa 框架的后端实现"></a>3. 基于 koa 框架的后端实现</h1><p><a href="https://koa.bootcss.com/" target="_blank" rel="noopener">Koa</a> 基于 Node.js 平台的下一代 web 开发框架</p>
<p><strong>注意: 需要深入理解 koa2 的 <a href="https://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001471087582981d6c0ea265bf241b59a04fa6f61d767f6000" target="_blank" rel="noopener">middlewares</a> 思想</strong></p>
<h2 id="3-1-使用-koa2-generator-生成工程目录"><a href="#3-1-使用-koa2-generator-生成工程目录" class="headerlink" title="3.1 使用 koa2-generator 生成工程目录"></a>3.1 使用 koa2-generator 生成工程目录</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. 安装 koa2-generator</span></span><br><span class="line">$ npm install -g koa2-generator</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 生成工程目录</span></span><br><span class="line">$ koa2 my-projet</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 安装工程依赖库</span></span><br><span class="line">$ <span class="built_in">cd</span> my-project</span><br><span class="line">$ npm install</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 运行工程</span></span><br><span class="line">$ npm run dev</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ node bin/www</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. 在浏览器输入 http://localhost:3000/ 即可看到工程运行结果</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-处理工程依赖-package-json"><a href="#3-2-处理工程依赖-package-json" class="headerlink" title="3.2 处理工程依赖 package.json"></a>3.2 处理工程依赖 package.json</h2><p>根据3.1创建工程后，可以在工程中找到 <a href="http://javascript.ruanyifeng.com/nodejs/packagejson.html" target="_blank" rel="noopener">package.json</a> 文件，里面详细记录了此工程的所有依赖模块，后续增删模块以来，只需要编辑此文件，然后执行下述命令即可:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<p>或者，通过下述命令安装单一模块，并将工程依赖关系写入 <code>package.json</code> 文件中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --save参数表示将该模块写入dependencies属性</span></span><br><span class="line">$ npm install express --save</span><br></pre></td></tr></table></figure>
<h2 id="3-3-Https-实现方式"><a href="#3-3-Https-实现方式" class="headerlink" title="3.3 Https 实现方式"></a>3.3 Https 实现方式</h2><p>在 <code>bin/www</code> 文件中，增加 https 相关代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpsPort = <span class="number">3010</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpsOptions = &#123;</span><br><span class="line">    key: fs.readFileSync(<span class="string">'../SSHKeys/privkey.pem'</span>), <span class="comment">//ssl key 文件路径</span></span><br><span class="line">    cert: fs.readFileSync(<span class="string">'../SSHKeys/fullchain.pem'</span>) <span class="comment">//ssl cert 文件路径</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpsServer = https.createServer(options, app.callback())</span><br><span class="line">httpsServer.listen(httpsPort)</span><br><span class="line">httpsServer.on(<span class="string">'error'</span>, onError)</span><br><span class="line">httpsServer.on(<span class="string">'listening'</span>, onListening)</span><br></pre></td></tr></table></figure>
<h2 id="3-4-MySQL-操作"><a href="#3-4-MySQL-操作" class="headerlink" title="3.4 MySQL 操作"></a>3.4 MySQL 操作</h2><p>使用 ORM 库 <a href="http://docs.sequelizejs.com/" target="_blank" rel="noopener">Sequelize</a><a href="https://demopark.github.io/sequelize-docs-Zh-CN/" target="_blank" rel="noopener">(中文版)</a>，实现 MySQL 操作</p>
<p>新建文件 <code>default.js</code>，写入 MySQL 相关配置信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dbConfig = &#123;</span><br><span class="line">    database: &#123;</span><br><span class="line">        DATABASE: <span class="string">'TestDB'</span>,</span><br><span class="line">        USERNAME: <span class="string">'testUser'</span>,</span><br><span class="line">        PASSWORD: <span class="string">'123456'</span>,</span><br><span class="line">        PORT: <span class="string">'3306'</span>,</span><br><span class="line">        HOST: <span class="string">'localhost'</span>,</span><br><span class="line">        DIALECT: <span class="string">'mysql'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    pool: &#123;</span><br><span class="line">        MAX: <span class="number">5</span>,</span><br><span class="line">        MIN: <span class="number">0</span>,</span><br><span class="line">        ACQUIRE: <span class="number">30000</span>,</span><br><span class="line">        IDLE: <span class="number">10000</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = dbConfig</span><br></pre></td></tr></table></figure>
<p>通过函数创建 MySQL 连接:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> Sequelize(</span><br><span class="line">    dbConfig.database.DATABASE,</span><br><span class="line">    dbConfig.database.USERNAME,</span><br><span class="line">    dbConfig.database.PASSWORD,</span><br><span class="line">    &#123;</span><br><span class="line">        host : dbConfig.database.HOST,</span><br><span class="line">        dialect : dbConfig.database.DIALECT,</span><br><span class="line">        pool: &#123;</span><br><span class="line">            max: dbConfig.pool.MAX,</span><br><span class="line">            min: dbConfig.pool.MIN,</span><br><span class="line">            acquire: dbConfig.pool.ACQUIRE,</span><br><span class="line">            idle: dbConfig.pool.IDLE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>定义相关的表:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> projectTable = db.define(<span class="string">'project'</span>, &#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">        type: Sequelize.STRING,</span><br><span class="line">        defaultValue: <span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    description: Sequelize.TEXT</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> taskTable = db.define(<span class="string">'task'</span>, &#123;</span><br><span class="line">    title: Sequelize.STRING,</span><br><span class="line">    description: Sequelize.TEXT,</span><br><span class="line">    isFinished: Sequelize.BOOLEAN</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todoListTable = db.define(<span class="string">'todoList'</span>, &#123;</span><br><span class="line">    label: Sequelize.STRING(<span class="number">100</span>),</span><br><span class="line">    isFinished: Sequelize.BOOLEAN</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来就可以通过 Sequelize 提供的各种接口对 MySQL 进行操作了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建新表</span></span><br><span class="line"><span class="keyword">const</span> createTable = <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> todoListTable.sync()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找并插入数据</span></span><br><span class="line"><span class="keyword">const</span> saveData = <span class="keyword">async</span>(itemNew) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> where = &#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            label: itemNew.label</span><br><span class="line">        &#125;,</span><br><span class="line">        defaults: &#123;</span><br><span class="line">            label: itemNew.label,</span><br><span class="line">            isFinished: itemNew.isFinished</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//通过返回值实现 .spread 的结果 </span></span><br><span class="line">        <span class="keyword">var</span> resultArray = <span class="keyword">await</span> todoListTable.findOrCreate(where)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'create result = '</span>, resultArray[<span class="number">1</span>])</span><br><span class="line">    &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> itemList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取数据</span></span><br><span class="line"><span class="keyword">const</span> loadAllData = <span class="keyword">async</span>() =&gt; &#123;    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> todoListTable.findAll()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改数据</span></span><br><span class="line"><span class="keyword">const</span> modifyData = <span class="keyword">async</span>(itemToModify) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> values = &#123;</span><br><span class="line">        isFinished: !itemToModify.isFinished</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> where = &#123;</span><br><span class="line">        where:&#123;</span><br><span class="line">            label: itemToModify.label</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> todoListTable.update(values, where)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除数据</span></span><br><span class="line"><span class="keyword">const</span> deleteData = <span class="keyword">async</span>(itemToDelete) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> where = &#123;</span><br><span class="line">        where: &#123;</span><br><span class="line">            label: itemToDelete.label</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> todoListTable.destroy(where)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-Nginx-配置"><a href="#4-Nginx-配置" class="headerlink" title="4. Nginx 配置"></a>4. Nginx 配置</h1><p><a href="https://baike.baidu.com/item/nginx/3817705?fr=aladdin" target="_blank" rel="noopener">Nginx</a> 是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在这里我们使用 Ngnix 对 VUE 生成的网页应用进行配置</p>
<h2 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1 安装"></a>4.1 安装</h2><p>CentOS 下，通过以下命令安装:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install nginx</span><br></pre></td></tr></table></figure>
<p>同时，可以通过下述命令进行服务启动、重启、停止等操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">$ nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置文件检查</span></span><br><span class="line">$ nginx -t</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载</span></span><br><span class="line">$ nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优雅停止：等待处理完所有数据再关闭</span></span><br><span class="line">$ nginx -s quit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制停止：强制关闭服务，忽略未处理完数据</span></span><br><span class="line">$ nginx -s stop</span><br></pre></td></tr></table></figure>
<p>查看 nginx 进程情况</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef|grep nginx</span><br></pre></td></tr></table></figure>
<h2 id="4-2-配置"><a href="#4-2-配置" class="headerlink" title="4.2 配置"></a>4.2 配置</h2><p>nginx 安装完毕后，会自动生成一个配置文件，打开配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p>可以看到如下配置信息，<a href="http://www.nginx.cn/76.html" target="_blank" rel="noopener">配置信息详解</a>：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/nginx/README.dynamic.</span></span><br><span class="line"><span class="keyword">include</span> /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动进程,通常设置成和cpu的数量相等</span></span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    <span class="comment"># epoll是多路复用IO(I/O Multiplexing)中的一种方式,</span></span><br><span class="line">    <span class="comment"># 仅用于linux2.6以上内核,可以大大提高nginx的性能</span></span><br><span class="line">    use epoll;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 单个后台worker process进程的最大并发链接数</span></span><br><span class="line">    worker_connections <span class="number">1024</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 并发总数是 worker_processes 和 worker_connections 的乘积</span></span><br><span class="line">    <span class="comment"># 即 max_clients = worker_processes * worker_connections</span></span><br><span class="line">    <span class="comment"># 在设置了反向代理的情况下，max_clients = worker_processes * worker_connections / 4  为什么</span></span><br><span class="line">    <span class="comment"># 为什么上面反向代理要除以4，应该说是一个经验值</span></span><br><span class="line">    <span class="comment"># 根据以上条件，正常情况下的Nginx Server可以应付的最大连接数为：4 * 8000 = 32000</span></span><br><span class="line">    <span class="comment"># worker_connections 值的设置跟物理内存大小有关</span></span><br><span class="line">    <span class="comment"># 因为并发受IO约束，max_clients的值须小于系统可以打开的最大文件数</span></span><br><span class="line">    <span class="comment"># 而系统可以打开的最大文件数和内存大小成正比，一般1GB内存的机器上可以打开的文件数大约是10万左右</span></span><br><span class="line">    <span class="comment"># 我们来看看360M内存的VPS可以打开的文件句柄数是多少：</span></span><br><span class="line">    <span class="comment"># $ cat /proc/sys/fs/file-max</span></span><br><span class="line">    <span class="comment"># 输出 34336</span></span><br><span class="line">    <span class="comment"># 32000 &lt; 34336，即并发连接总数小于系统可以打开的文件句柄总数，这样就在操作系统可以承受的范围之内</span></span><br><span class="line">    <span class="comment"># 所以，worker_connections 的值需根据 worker_processes 进程数目和系统可以打开的最大文件总数进行适当地进行设置</span></span><br><span class="line">    <span class="comment"># 使得并发总数小于操作系统可以打开的最大文件数目</span></span><br><span class="line">    <span class="comment"># 其实质也就是根据主机的物理CPU和内存进行配置</span></span><br><span class="line">    <span class="comment"># 当然，理论上的并发总数可能会和实际有所偏差，因为主机还有其他的工作进程需要消耗系统资源。</span></span><br><span class="line">    <span class="comment"># ulimit -SHn 65535</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 连接超时时间</span></span><br><span class="line">    keepalive_timeout   <span class="number">65</span>;</span><br><span class="line">    types_hash_max_size <span class="number">2048</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load modular configuration files from the /etc/nginx/conf.d directory.</span></span><br><span class="line">    <span class="comment"># See http://nginx.org/en/docs/ngx_core_module.html#include</span></span><br><span class="line">    <span class="comment"># for more information.</span></span><br><span class="line">    <span class="keyword">include</span> /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置 HTTP server</span></span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="comment"># 侦听端口</span></span><br><span class="line">        listen       <span class="number">4000</span>;</span><br><span class="line">        <span class="comment"># 服务器地址 : 固定 ip 或者域名</span></span><br><span class="line">        server_name  <span class="number">120.25</span>.<span class="number">107.164</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 定义服务器的默认网站根目录位置</span></span><br><span class="line">        root         /data/www;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设定本虚拟主机的访问日志</span></span><br><span class="line">        access_log  logs/nginx.access.log  main;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">        <span class="keyword">include</span> /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            <span class="comment"># 定义首页索引文件的名称</span></span><br><span class="line">            index index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 定义错误提示页面</span></span><br><span class="line">        error_page <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">            location = <span class="regexp">/40x.html &#123;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        error_page 500 502 503 504 /</span><span class="number">50</span>x.html;</span><br><span class="line">            location = <span class="regexp">/50x.html &#123;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    # 配置 HTTPS server</span></span><br><span class="line"><span class="regexp">    server &#123;</span></span><br><span class="line"><span class="regexp">        listen        4010;</span></span><br><span class="line"><span class="regexp">        server_name   120.25.107.164;</span></span><br><span class="line"><span class="regexp">        root          /data</span><span class="regexp">/www;</span></span><br><span class="line"><span class="regexp">        include       /etc</span><span class="regexp">/nginx/default</span>.d/*.conf;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># HTTPS 相关配置 begin</span></span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate /home/workplace/SSHKeys/fullchain.pem;</span><br><span class="line">        ssl_certificate_key /home/workplace/SSHKeys/privkey.pem;</span><br><span class="line">        ssl_session_timeout <span class="number">5</span>m;</span><br><span class="line">        <span class="comment">#ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-<span class="symbol">SHA256:</span><span class="symbol">ECDHE:</span><span class="symbol">ECDH:</span><span class="symbol">AES:</span><span class="symbol">HIGH:</span>!<span class="symbol">NULL:</span>!<span class="symbol">aNULL:</span>!<span class="symbol">MD5:</span>!<span class="symbol">ADH:</span>!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        <span class="comment"># HTTPS 相关配置 end</span></span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            index index.html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page <span class="number">404</span> /<span class="number">404</span>.html;</span><br><span class="line">            location = <span class="regexp">/40x.html &#123;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        error_page 500 502 503 504 /</span><span class="number">50</span>x.html;</span><br><span class="line">            location = <span class="regexp">/50x.html &#123;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/13/vue+koa2+mySQL+Ngnix框架搭建备忘/" data-id="cjg31vbqz000kwitpojl0czcl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/04/17/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2016/11/06/iOS — Slider with Container View/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS —— 使用 Container View 实现左右侧栏</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IOS技术/">IOS技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS技术/">iOS技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/博客搭建/">博客搭建</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术文档翻译/">技术文档翻译</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IOS开发/">IOS开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS开发/">iOS开发</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IOS开发/" style="font-size: 10px;">IOS开发</a> <a href="/tags/Swift/" style="font-size: 20px;">Swift</a> <a href="/tags/iOS开发/" style="font-size: 20px;">iOS开发</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/17/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/04/13/vue+koa2+mySQL+Ngnix框架搭建备忘/">(no title)</a>
          </li>
        
          <li>
            <a href="/2016/11/06/iOS — Slider with Container View/">iOS —— 使用 Container View 实现左右侧栏</a>
          </li>
        
          <li>
            <a href="/2016/11/06/iOS — 使用 Container View 实现左右侧栏/">iOS —— 使用 Container View 实现左右侧栏</a>
          </li>
        
          <li>
            <a href="/2016/04/17/iOS-Architecture-Patterns/">iOS 软件架构 - MVC, MVP, MVVM 和 VIPER 「译」</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>